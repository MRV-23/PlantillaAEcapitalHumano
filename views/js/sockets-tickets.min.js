class TicketsUsuarios{constructor(){this.formulario=$("#formularioNuevoTicketUsuario"),this.categorias=$("#areaSistemas"),this.subcategorias=$("#cargarSubCategoriaTickets"),this.cargarSegmento=$("#segmentoTickets"),this.imagenTicket=$("#cargarImagenTicket"),this.documentoTicket=$("#cargarDocumentoTicket"),this.lienzo=$("#lienzoArchivosTickets"),this.lienzoDocumentos=$("#lienzoDocumentosTickets"),this.imagen=$(".imagenTicket"),this.abrirTicket=$("#reabrirTicketSoporte"),this.folio=$("#folioTicket"),this.cargarTickets=$("#actualizarTicketsUsuarios"),this.actualizarHistorial=$("#actualizarHistorialTickets"),this.mostrarRegistro=$(".mostrarDatosTicketUsuario")}static generarNuevoTicket(o){let t=new FormData(o.formulario[0]);swal({title:'<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>',text:" Por favor espere...",type:"",showConfirmButton:!1,allowOutsideClick:!1}),$.ajax({url:ruta_server+"controllers/AjaxTickets.php",method:"POST",data:t,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){e.error?swal({type:e.tipo,title:e.mensaje,text:e.mensaje2}).catch(swal.noop):(swal({type:e.tipo,title:e.mensaje,text:e.mensaje2}).catch(swal.noop),TicketsUsuarios.resetear(o),socket.emit("nuevoTicket",{categoria:t.entries().next().value[1],folio:e.folio},o=>{}),socket.emit("actualizarColaTickets",null),TicketsUsuarios.actualizarHistorial(o))}})}static reabrirTicket(o,t){swal({title:"¿Deseas abrir el ticket?",text:"",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, continuar!"}).then(e=>{swal({title:'<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>',text:" Por favor espere...",type:"",showConfirmButton:!1,allowOutsideClick:!1}),$.ajax({type:"POST",url:ruta_server+"controllers/AjaxTickets.php",dataType:"json",data:{idReabrirTicket:o}}).done(function(o){swal({type:o.tipo,title:o.mensaje,text:o.mensaje2}).catch(swal.noop),$("#mostrarDatosTicket").modal("hide"),o.status&&socket.emit("reabrirTicket",t)}).fail(function(o){console.log("Ocurrio un error:",o),swal({type:"error",title:"Ocurrio un error",text:"No se encontró la ruta del archivo"}).catch(swal.noop),$("#mostrarDatosTicket").modal("hide")})}).catch(o=>{})}static mostrarDatosTicket(o,t){let e=o.parent().parent().attr("id");$.ajax({type:"POST",url:ruta_server+"controllers/AjaxTickets.php",dataType:"json",data:{idTicketRevision:e}}).done(function(e){recargar_solicitudes(),$(o).children().html('<i class="fa fa-eye text-black"></i>'),$(".divDatosTicketEncabezado").html(e.html),$(".divDatosTicket").html(e.html2),$(".divDatosTicket2").html(e.html3),null!=e.imagen?(t.imagen.attr("src",ruta_server+"views/imagenes-usuarios/mini/"+e.imagen),t.imagen.attr("alt",ruta_server+"views/imagenes-usuarios/"+e.imagen)):(t.imagen.attr("src",ruta_server+"views/img/user.png"),t.imagen.attr("alt",ruta_server+"views/img/user.png")),e.estadoBoton<2?t.abrirTicket.hide():t.abrirTicket.show()}).fail(function(o){console.log("Ocurrio un error:",o)})}static resetear(o){o.formulario[0].reset(),o.subcategorias.html('<select class="form-control textoMay" name="subCategoriaTickets" id="subCategoriaTickets" required readonly><option></option></select>'),o.cargarSegmento.html(""),o.imagenTicket.val(""),o.documentoTicket.val(""),o.lienzo.html(""),o.lienzoDocumentos.html("")}static actualizarHistorial(o){o.cargarTickets.html('<div style="text-align:center"><img src="'+ruta_server+'views/img/status.gif"></div>'),$.ajax({type:"POST",url:ruta_server+"controllers/AjaxTickets.php",dataType:"json",data:{actualizarHistorial:!0}}).done(function(t){o.cargarTickets.html(t.html),$(".mostrarDatosTicketUsuario").click(function(){TicketsUsuarios.mostrarDatosTicket($(this),o)})}).fail(function(o){console.log("Ocurrio un error:",o)})}static inicarClase(){let o=new TicketsUsuarios;o.formulario.submit(function(t){t.preventDefault(),TicketsUsuarios.generarNuevoTicket(o)}),o.categorias.change(function(){if(""!=$(this).val())if(1==$(this).val())o.cargarSegmento.html(""),o.subcategorias.html('<select class="form-control textoMay" name="subCategoriaTickets" id="subCategoriaTickets" required><option></option><option value="1">Carpetas en Red</option><option value="2">CONTPAQi Adminpaq</option><option value="3">CONTPAQi Contabilidad y Bancos</option><option value="4">CONTPAQi Facturación</option><option value="5">CONTPAQi Nomipaq</option><option value="6">Correo electrónico</option><option value="7">Impresoras y Toner</option><option value="8">Paquetería Office(Excel,Word, Power Point, etc.)</option><option value="9">Red e Internet</option><option value="10">Spark</option><option value="11">XML</option><option value="12">Otra</option></select>');else if(2==$(this).val()){o.subcategorias.html('<select class="form-control textoMay" name="subCategoriaTickets" id="subCategoriaTickets" required><option></option><option value="1">Nóminas</option><option value="2">Procesos IMSS</option><option value="3">Módulo Pre Alta</option><option value="4">Módulo Recibos CFDI</option><option value="5">Módulo Archivo Electrónico</option><option value="6">Otra</option></select>');let t=$("#subCategoriaTickets");t.change(function(){""!=t.val()?1==t.val()?o.cargarSegmento.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8"><label for="passActual">2.1.-Segmento: </label> <i class="fa fa-check-circle text-green"></i><div id="cargarSubCategoriaTickets"><select class="form-control textoMay" name="segmentoTickets" required><option></option><option value="1">Cálculos Ordinarios</option><option value="2">Cálculos Extraordinarios</option><option value="3">Finiquitos</option><option value="4">Aguinaldos</option><option value="5">Conexión a escritorio remoto</option><option value="6">Usuarios y contraseñas</option><option value="7">Reportes</option><option value="8">Timbrado</option><option value="9">Alta de Clientes / Tipos de Nómina</option><option value="10">Alta de Puestos</option><option value="11">Alta de Turnos</option><option value="12">Movimientos masivos</option><option value="13">Otros</option></select></div></div></div>'):2==t.val()?o.cargarSegmento.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8"><label for="passActual">2.1.-Segmento: </label> <i class="fa fa-check-circle text-green"></i><div id="cargarSubCategoriaTickets"><select class="form-control textoMay" name="segmentoTickets" required><option></option><option value="1">Altas</option><option value="2">Bajas</option><option value="3">Modificaciones salariales</option><option value="4">Reingresos</option><option value="5">Alta de Registros patronales</option><option value="6">INFONAVIT</option><option value="7">FONACOT</option><option value="8">Movimientos masivos</option><option value="9">Otros</option></select></div></div></div>'):3==t.val()?o.cargarSegmento.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8"><label for="passActual">2.1.-Segmento: </label> <i class="fa fa-check-circle text-green"></i><div id="cargarSubCategoriaTickets"><select class="form-control textoMay" name="segmentoTickets" required><option></option><option value="1">Captura de información</option><option value="2">Correo electrónico</option><option value="3">Exportación de empleados</option><option value="4">Otros</option></select></div></div></div>'):4==t.val()?o.cargarSegmento.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8"><label for="passActual">2.1.-Segmento: </label> <i class="fa fa-check-circle text-green"></i><div id="cargarSubCategoriaTickets"><select class="form-control textoMay" name="segmentoTickets" required><option></option><option value="1">Error en timbre</option><option value="2">XML y PDF</option><option value="3">Reportes</option><option value="4">Falta de timbres</option><option value="5">Otros</option></select></div></div></div>'):5==t.val()?o.cargarSegmento.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8"><label for="passActual">2.1.-Segmento: </label> <i class="fa fa-check-circle text-green"></i><div id="cargarSubCategoriaTickets"><select class="form-control textoMay" name="segmentoTickets" required><option></option><option value="1">Alta de nuevos documentos</option><option value="2">Otros</option></select></div></div></div>'):o.cargarSegmento.html(""):o.cargarSegmento.html("")})}else 3==$(this).val()&&(o.cargarSegmento.html(""),o.subcategorias.html('<select class="form-control textoMay" name="subCategoriaTickets" id="subCategoriaTickets" required><option></option><option value="1">Ingreso al sistema</option><option value="2">Módulo agenda empresarial</option><option value="3">Módulo inicio</option><option value="4">Módulo mi cuenta</option><option value="5">Módulo paquetería</option><option value="6">Módulo solicitudes</option><option value="7">Módulo tickets</option><option value="8">Otra</option></select>'));else o.subcategorias.html('<select class="form-control textoMay" name="subCategoriaTickets" id="subCategoriaTickets" required readonly><option></option></select>'),o.cargarSegmento.html("")}),$("#formularioCancelarTicketUsuario").click(function(){TicketsUsuarios.resetear(o)}),o.mostrarRegistro.click(function(){TicketsUsuarios.mostrarDatosTicket($(this),o)}),o.imagenTicket.change(function(t){let e=t.target.files[0];if(!/\.(?=jpg|png|jpeg)/gi.test(e.name))return o.imagenTicket.val(""),void swal("Sólo se permiten imagenes","Formato: .jpg, .jpeg y .png","error").catch(swal.noop);if(e.size>2097152)return o.imagenTicket.val(""),void swal("La imagen tiene un tamaño mayor al permitido","El peso máximo es de 2 MB","error").catch(swal.noop);o.lienzo.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8" ><div class="alert alert-success alert-dismissible"><i class="icon fa fa-check"></i> IMAGEN: '+e.name+'<button type="button" id="cancelarImagen" class="close" aria-hidden="true">&times;</button></div></div></div>'),$("#cancelarImagen").click(function(){o.imagenTicket.val(""),o.lienzo.html("")})}),o.documentoTicket.change(function(t){let e=t.target.files[0];if(!/\.(?=docx|doc|xlsx|xls|pdf)/gi.test(e.name))return o.documentoTicket.val(""),void swal("Formato no válido","Formatos válidos: .doc, .docx, .xls, .xlsx, y .pdf","error").catch(swal.noop);if(e.size>2097152)return o.documentoTicket.val(""),void swal("El documento tiene un tamaño mayor al permitido","El peso máximo es de 2 MB","error").catch(swal.noop);o.lienzoDocumentos.html('<div class="row"><div class="col-md-2"></div><div class="col-md-8" ><div class="alert alert-info alert-dismissible"><i class="icon fa fa-check"></i> DOCUMENTO: '+e.name+'<button type="button" id="cancelarImagen2" class="close" aria-hidden="true">&times;</button></div></div></div>'),$("#cancelarImagen2").click(function(){o.documentoTicket.val(""),o.lienzoDocumentos.html("")})}),o.abrirTicket.click(function(){TicketsUsuarios.reabrirTicket($("#folioTicket").attr("value"),$("#categoriaTicketModal").attr("value"))}),o.actualizarHistorial.click(function(){TicketsUsuarios.actualizarHistorial(o)})}}TicketsUsuarios.inicarClase();